<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kubernetes Dashboard</title>
    <script>
      (function () {
        const storageKey = 'dashboard-theme';
        let theme;
        try {
          const stored = window.localStorage.getItem(storageKey);
          if (stored === 'light' || stored === 'dark') {
            theme = stored;
          }
        } catch (err) {
          theme = undefined;
        }

        if (!theme) {
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          theme = prefersDark ? 'dark' : 'light';
        }

        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
    <style>
      :root {
        color-scheme: light;
        --bg: #f4f6fb;
        --bg-elevated: rgba(255, 255, 255, 0.86);
        --sidebar-bg: rgba(255, 255, 255, 0.78);
        --overlay-top: rgba(37, 99, 235, 0.08);
        --overlay-bottom: rgba(125, 211, 252, 0.08);
        --divider: rgba(148, 163, 184, 0.18);
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --accent: #2563eb;
        --accent-strong: #1d4ed8;
        --success: #16a34a;
        --warning: #f97316;
        --danger: #dc2626;
        --card-bg: rgba(255, 255, 255, 0.92);
        --card-border: rgba(148, 163, 184, 0.18);
        --card-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
        --muted-surface: rgba(148, 163, 184, 0.12);
        --input-bg: rgba(255, 255, 255, 0.9);
        --input-border: rgba(148, 163, 184, 0.35);
        --table-hover: rgba(37, 99, 235, 0.08);
        --table-active: rgba(37, 99, 235, 0.16);
        --log-panel-bg: rgba(15, 23, 42, 0.05);
      }

      :root[data-theme='dark'] {
        color-scheme: dark;
        --bg: #020617;
        --bg-elevated: rgba(15, 23, 42, 0.88);
        --sidebar-bg: rgba(2, 6, 23, 0.9);
        --overlay-top: rgba(56, 189, 248, 0.12);
        --overlay-bottom: rgba(14, 165, 233, 0.12);
        --divider: rgba(148, 163, 184, 0.15);
        --text-primary: #e2e8f0;
        --text-secondary: #94a3b8;
        --accent: #38bdf8;
        --accent-strong: #0ea5e9;
        --success: #22c55e;
        --warning: #f97316;
        --danger: #ef4444;
        --card-bg: rgba(15, 23, 42, 0.6);
        --card-border: rgba(148, 163, 184, 0.18);
        --card-shadow: 0 24px 48px rgba(2, 6, 23, 0.35);
        --muted-surface: rgba(148, 163, 184, 0.12);
        --input-bg: rgba(15, 23, 42, 0.35);
        --input-border: rgba(148, 163, 184, 0.35);
        --table-hover: rgba(56, 189, 248, 0.12);
        --table-active: rgba(56, 189, 248, 0.18);
        --log-panel-bg: rgba(15, 23, 42, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif;
        background: radial-gradient(circle at top, var(--overlay-top), transparent 55%),
          radial-gradient(circle at bottom, var(--overlay-bottom), transparent 55%),
          var(--bg);
        color: var(--text-primary);
        min-height: 100vh;
      }

      .app-shell {
        display: grid;
        grid-template-columns: 260px 1fr;
        min-height: 100vh;
        backdrop-filter: blur(18px);
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        padding: 28px 24px;
        gap: 32px;
        background: var(--sidebar-bg);
        border-right: 1px solid var(--divider);
      }

      .brand {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .brand span {
        letter-spacing: 0.24em;
        font-size: 12px;
        text-transform: uppercase;
        color: var(--text-secondary);
      }

      .brand strong {
        font-size: 20px;
        font-weight: 700;
        color: var(--accent);
      }

      .menu {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .menu a {
        text-decoration: none;
        padding: 12px 16px;
        border-radius: 12px;
        color: var(--text-secondary);
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: background 0.2s ease, color 0.2s ease;
      }

      .menu a::before {
        content: "";
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--divider);
      }

      .menu a.active,
      .menu a:hover {
        background: rgba(56, 189, 248, 0.15);
        color: var(--accent);
      }

      .menu a.active::before,
      .menu a:hover::before {
        background: var(--accent);
      }

      .sidebar-footer {
        margin-top: auto;
        padding: 16px;
        border-radius: 16px;
        background: rgba(56, 189, 248, 0.12);
        border: 1px solid rgba(56, 189, 248, 0.25);
        font-size: 13px;
        line-height: 1.5;
        color: var(--text-secondary);
      }

      .main {
        display: flex;
        flex-direction: column;
        background: var(--bg-elevated);
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 24px 36px;
        border-bottom: 1px solid var(--divider);
        gap: 24px;
      }

      .topbar h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 700;
      }

      .subtitle {
        margin: 6px 0 0;
        font-size: 14px;
        color: var(--text-secondary);
      }

      .topbar-meta {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .topbar-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .timestamp {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .refresh-button {
        padding: 10px 18px;
        border-radius: 999px;
        border: 1px solid rgba(56, 189, 248, 0.35);
        background: rgba(56, 189, 248, 0.12);
        color: var(--accent-strong);
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s ease, background 0.15s ease;
      }

      .theme-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        border-radius: 999px;
        border: 1px solid var(--divider);
        background: var(--card-bg);
        color: var(--text-secondary);
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s ease, background 0.15s ease, color 0.15s ease;
      }

      .theme-toggle:hover {
        background: var(--table-hover);
        color: var(--accent);
        transform: translateY(-1px);
      }

      .theme-toggle:active {
        transform: translateY(1px);
      }

      .theme-icon {
        font-size: 18px;
      }

      .theme-label {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .refresh-button:hover {
        background: rgba(56, 189, 248, 0.2);
        transform: translateY(-1px);
      }

      .refresh-button:active {
        transform: translateY(1px);
      }

      .content {
        padding: 32px 36px 48px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .view {
        display: none;
        flex-direction: column;
        gap: 24px;
      }

      .view.active {
        display: flex;
      }

      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
      }

      .card {
        backdrop-filter: blur(16px);
        background: var(--card-bg);
        border-radius: 18px;
        padding: 24px;
        box-shadow: var(--card-shadow);
        border: 1px solid var(--card-border);
      }

      .card h2 {
        margin: 0 0 18px;
        font-size: 16px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .info-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 12px;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        border-radius: 12px;
        background: var(--muted-surface);
      }

      .metric {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .metric .label {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .metric-bar {
        height: 8px;
        border-radius: 999px;
        background: var(--muted-surface);
        overflow: hidden;
      }

      .metric-bar span {
        display: block;
        height: 100%;
        border-radius: 999px;
        background: linear-gradient(90deg, var(--accent) 0%, var(--accent-strong) 100%);
      }

      .events {
        display: grid;
        gap: 12px;
      }

      .event {
        padding: 16px;
        border-radius: 12px;
        background: var(--muted-surface);
        border-left: 4px solid transparent;
      }

      .event.warning {
        border-left-color: var(--warning);
      }

      .event.normal {
        border-left-color: var(--success);
      }

      .event .title {
        font-weight: 600;
        margin-bottom: 8px;
      }

      .event .message {
        color: var(--text-secondary);
        margin-bottom: 12px;
      }

      .event .footer {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .error {
        padding: 16px;
        border-radius: 14px;
        background: rgba(239, 68, 68, 0.18);
        color: var(--danger);
        font-weight: 600;
        border: 1px solid rgba(239, 68, 68, 0.35);
      }

      .feedback-box {
        padding: 12px 16px;
        border-radius: 12px;
        font-size: 14px;
        display: none;
      }

      .feedback-box.success {
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.35);
      }

      .feedback-box.error {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.35);
      }

      .namespace-card,
      .node-card,
      .node-detail,
      .deploy-card,
      .deploy-detail,
      .pod-card,
      .pod-detail {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .namespace-form {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .namespace-form input {
        flex: 1 1 220px;
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-primary);
      }

      .namespace-form button {
        padding: 10px 18px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(90deg, var(--accent) 0%, var(--accent-strong) 100%);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }

      .table-toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
        margin: 8px 0 12px;
      }

      .table-toolbar .table-hint {
        color: var(--text-secondary);
        font-size: 13px;
      }

      .search-input {
        flex: 1 1 220px;
        min-width: 200px;
        padding: 8px 14px;
        border-radius: 12px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-primary);
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
      }

      .deploy-form {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .deploy-form input {
        width: 120px;
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-primary);
      }

      .deploy-form button {
        padding: 10px 18px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(90deg, var(--accent) 0%, var(--accent-strong) 100%);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      .log-table-wrapper {
        max-height: 360px;
        overflow-y: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      thead {
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }

      th {
        text-align: left;
        font-weight: 600;
      }

      th,
      td {
        padding: 12px 16px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.15);
        text-align: left;
      }

      tbody tr:hover {
        background: var(--table-hover);
      }

      .namespace-table button,
      .node-table button {
        padding: 6px 12px;
        border-radius: 10px;
        border: 1px solid rgba(239, 68, 68, 0.35);
        background: rgba(239, 68, 68, 0.12);
        color: var(--danger);
        cursor: pointer;
      }

      .nodes-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
      }

      .deploys-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
      }

      .node-table tbody tr {
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .node-table tbody tr.active {
        background: var(--table-active);
      }

      .pods-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
      }

      .services-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
      }

      .logs-grid {
        display: grid;
        grid-template-columns: 1.6fr 1fr;
        gap: 24px;
      }

      .deploy-table tbody tr {
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .deploy-table tbody tr.active {
        background: var(--table-active);
      }

      .pod-table tbody tr {
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .pod-table tbody tr.active {
        background: var(--table-active);
      }

      .service-table tbody tr {
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .service-table tbody tr.active {
        background: var(--table-active);
      }

      .filter-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .filter-bar select,
      .filter-bar label {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .filter-select {
        padding: 8px 14px;
        border-radius: 12px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-primary);
        min-width: 150px;
      }

      .filter-select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
      }

      .auto-scroll-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        background: var(--muted-surface);
        color: var(--text-secondary);
        font-size: 13px;
      }

      .auto-scroll-toggle input {
        accent-color: var(--accent);
      }

      .view-events-button,
      .import-button {
        padding: 10px 18px;
        border-radius: 999px;
        border: 1px solid var(--accent);
        background: rgba(37, 99, 235, 0.12);
        color: var(--accent-strong);
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s ease, background 0.15s ease;
      }

      .view-events-button:hover,
      .import-button:hover {
        background: rgba(37, 99, 235, 0.2);
        transform: translateY(-1px);
      }

      .view-events-button:active,
      .import-button:active {
        transform: translateY(1px);
      }

      .view-events-button:disabled,
      .import-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      #kubeconfig-input {
        display: none;
      }

      .import-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        margin-bottom: 12px;
      }

      .import-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 8px;
      }

      .import-list li {
        background: var(--muted-surface);
        border-radius: 12px;
        padding: 12px 14px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .import-list small {
        color: var(--text-secondary);
      }

      .modal {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.65);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
        z-index: 1000;
        backdrop-filter: blur(6px);
      }

      .modal.show {
        display: flex;
      }

      .modal-body {
        background: var(--card-bg);
        border-radius: 18px;
        border: 1px solid var(--card-border);
        box-shadow: var(--card-shadow);
        max-width: 640px;
        width: 100%;
        max-height: 80vh;
        overflow-y: auto;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .modal-close {
        border: none;
        background: rgba(148, 163, 184, 0.18);
        color: var(--text-secondary);
        padding: 8px 14px;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.15s ease;
      }

      .modal-close:hover {
        background: rgba(148, 163, 184, 0.28);
      }

      body.modal-open {
        overflow: hidden;
      }

      .log-table tbody tr {
        transition: background 0.2s ease;
      }

      .log-table tbody tr:hover {
        background: var(--table-hover);
      }

      .log-level-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.06em;
      }

      .log-level-info {
        background: rgba(37, 99, 235, 0.12);
        color: var(--accent-strong);
      }

      .log-level-warn {
        background: rgba(245, 158, 11, 0.18);
        color: #b45309;
      }

      .log-level-error {
        background: rgba(220, 38, 38, 0.18);
        color: var(--danger);
      }

      .event-timeline {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 12px;
      }

      .event-timeline li {
        background: var(--muted-surface);
        border-radius: 12px;
        padding: 14px 16px;
        display: grid;
        gap: 6px;
        border-left: 4px solid transparent;
      }

      .event-timeline li.warning {
        border-left-color: var(--warning);
      }

      .event-timeline li.normal {
        border-left-color: var(--success);
      }

      .event-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .event-meta span {
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .badge.ready {
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
      }

      .badge.notready {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
      }

      .badge.unknown {
        background: rgba(148, 163, 184, 0.15);
        color: var(--text-secondary);
      }

      .chip {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(56, 189, 248, 0.12);
        border: 1px solid rgba(56, 189, 248, 0.25);
        font-size: 12px;
        color: var(--accent);
        margin-right: 8px;
        margin-bottom: 6px;
      }

      .chip-group {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .node-detail h3,
      .deploy-detail h3,
      .pod-detail h3,
      .service-detail h3 {
        margin: 0;
        font-size: 20px;
      }

      .detail-meta,
      .detail-metrics,
      .detail-section {
        display: grid;
        gap: 12px;
      }

      .detail-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .detail-meta {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      }

      .detail-meta .item,
      .metric-pill {
        background: rgba(15, 23, 42, 0.35);
        border-radius: 12px;
        padding: 12px 14px;
      }

      .metric-pill strong {
        display: block;
        margin-bottom: 4px;
      }

      .detail-section ul,
      .events-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 8px;
      }

      .detail-section li,
      .events-list li {
        background: rgba(15, 23, 42, 0.35);
        border-radius: 10px;
        padding: 10px 12px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .detail-section small,
      .events-list small {
        color: var(--text-secondary);
      }

      .log-panel {
        background: var(--log-panel-bg);
        border-radius: 12px;
        padding: 12px 14px;
        max-height: 220px;
        overflow-y: auto;
        font-family: "JetBrains Mono", "Fira Code", monospace;
        font-size: 13px;
        line-height: 1.6;
      }

      @media (max-width: 1200px) {
        .nodes-grid,
        .deploys-grid,
        .pods-grid,
        .services-grid,
        .logs-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 960px) {
        .app-shell {
          grid-template-columns: 1fr;
        }

        .sidebar {
          flex-direction: row;
          align-items: center;
          gap: 16px;
          overflow-x: auto;
        }

        .sidebar-footer {
          display: none;
        }
      }

      @media (max-width: 720px) {
        .topbar {
          flex-direction: column;
          align-items: flex-start;
        }

        .topbar-meta {
          width: 100%;
          justify-content: space-between;
        }

        .content {
          padding: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="brand">
          <span>kubernetes</span>
          <strong>Cluster Studio</strong>
        </div>
        <nav class="menu">
          <a class="active" data-view="overview" href="#">é›†ç¾¤æ¦‚è§ˆ</a>
          <a data-view="namespaces" href="#">å‘½åç©ºé—´</a>
          <a data-view="nodes" href="#">èŠ‚ç‚¹ç®¡ç†</a>
          <a data-view="deployments" href="#">éƒ¨ç½²ä¸å‘å¸ƒ</a>
          <a data-view="services" href="#">æœåŠ¡ç®¡ç†</a>
          <a data-view="pods" href="#">Pod ç®¡ç†</a>
          <a data-view="logs" href="#">æ—¥å¿—äº‹ä»¶</a>
        </nav>
        <div class="sidebar-footer">
          ğŸŒŸ å°è´´å£«ï¼šMock æ•°æ®æ¯ 15 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œæ¥å…¥çœŸå®é›†ç¾¤æ—¶å¯å¤ç”¨åŒä¸€å¥— UI ç»“æ„ã€‚
        </div>
      </aside>
      <main class="main">
        <header class="topbar">
          <div>
            <h1 id="view-title">é›†ç¾¤æ¦‚è§ˆ</h1>
            <p class="subtitle" id="view-subtitle">å®æ—¶æŒæ¡é›†ç¾¤çŠ¶æ€ã€èµ„æºä½¿ç”¨ä¸å…³é”®äº‹ä»¶åŠ¨æ€</p>
          </div>
          <div class="topbar-meta">
            <span class="timestamp" id="last-updated">åŠ è½½ä¸­...</span>
            <div class="topbar-actions">
              <button type="button" class="theme-toggle" id="theme-toggle">
                <span class="theme-icon" aria-hidden="true">ğŸŒ™</span>
                <span class="theme-label" id="theme-label">æ˜Ÿå¤œæ¨¡å¼</span>
              </button>
              <button type="button" class="refresh-button" id="manual-refresh">æ‰‹åŠ¨åˆ·æ–°</button>
            </div>
          </div>
        </header>
        <div class="content">
          <div id="error" class="error" style="display: none;"></div>

          <section class="view active" data-view="overview">
            <div class="cards-grid">
              <div class="card" id="cluster-info">
                <h2>CLUSTER INFO</h2>
                <ul class="info-list"></ul>
              </div>
              <div class="card" id="resource-usage">
                <h2>RESOURCE USAGE</h2>
                <div class="metrics"></div>
              </div>
              <div class="card" id="recent-events">
                <h2>RECENT EVENTS</h2>
                <div class="events"></div>
              </div>
              <div class="card" id="cluster-import">
                <h2>CLUSTER IMPORT</h2>
                <p class="subtitle">å¯¼å…¥ kubeconfig æ–‡ä»¶ä»¥å¿«é€Ÿæ¥å…¥é›†ç¾¤</p>
                <div class="import-actions">
                  <input id="kubeconfig-input" type="file" accept=".yaml,.yml,.json,.conf" />
                  <button type="button" class="import-button" id="kubeconfig-trigger">å¯¼å…¥ kubeconfig</button>
                </div>
                <div id="kubeconfig-feedback" class="feedback-box"></div>
                <ul class="import-list" id="import-list">
                  <li>
                    <strong>å°šæœªå¯¼å…¥é›†ç¾¤</strong>
                    <small>ä¸Šä¼  kubeconfig æ–‡ä»¶åï¼Œè¿™é‡Œä¼šå±•ç¤ºè§£æç»“æœ</small>
                  </li>
                </ul>
              </div>
            </div>
          </section>

          <section class="view" data-view="namespaces">
            <div class="card namespace-card">
              <div>
                <h2>NAMESPACE LIST</h2>
                <p class="subtitle">é›†ä¸­ç®¡ç†å‘½åç©ºé—´ï¼Œçµæ´»éš”ç¦»åº”ç”¨ç¯å¢ƒ</p>
              </div>
              <div class="table-toolbar">
                <span class="table-hint" id="namespace-count" data-default="æ”¯æŒæŒ‰åç§°ã€çŠ¶æ€æˆ–æ ‡ç­¾ç­›é€‰å‘½åç©ºé—´">æ”¯æŒæŒ‰åç§°ã€çŠ¶æ€æˆ–æ ‡ç­¾ç­›é€‰å‘½åç©ºé—´</span>
                <input type="search" id="namespace-search" class="search-input" placeholder="æœç´¢å‘½åç©ºé—´..." />
              </div>
              <form id="namespace-form" class="namespace-form">
                <input
                  id="namespace-name"
                  name="name"
                  type="text"
                  placeholder="è¯·è¾“å…¥å‘½åç©ºé—´åç§°ï¼Œä¾‹å¦‚ staging"
                  pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?"
                  maxlength="63"
                  required
                />
                <button type="submit">åˆ›å»ºå‘½åç©ºé—´</button>
              </form>
              <div id="namespace-feedback" class="feedback-box"></div>
              <div class="table-wrapper">
                <table class="namespace-table" id="namespace-table">
                  <thead>
                    <tr>
                      <th>åç§°</th>
                      <th>çŠ¶æ€</th>
                      <th>å­˜åœ¨æ—¶é—´</th>
                      <th>åˆ›å»ºæ—¶é—´</th>
                      <th>æ ‡ç­¾</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </section>

          <section class="view" data-view="nodes">
            <div class="nodes-grid">
              <div class="card node-card">
                <div>
                  <h2>NODE LIST</h2>
                  <p class="subtitle">è§‚å¯ŸèŠ‚ç‚¹çš„èµ„æºåˆ©ç”¨ç‡ä¸è¿è¡ŒçŠ¶å†µ</p>
                </div>
                <div class="table-toolbar">
                  <span class="table-hint" id="node-count" data-default="æŒ‰åç§°ã€è§’è‰²æˆ–çŠ¶æ€å¿«é€ŸæŸ¥æ‰¾èŠ‚ç‚¹">æŒ‰åç§°ã€è§’è‰²æˆ–çŠ¶æ€å¿«é€ŸæŸ¥æ‰¾èŠ‚ç‚¹</span>
                  <input type="search" id="node-search" class="search-input" placeholder="æœç´¢èŠ‚ç‚¹..." />
                </div>
                <div id="nodes-feedback" class="feedback-box"></div>
                <div class="table-wrapper">
                  <table class="node-table" id="node-table">
                    <thead>
                      <tr>
                        <th>åç§°</th>
                        <th>çŠ¶æ€</th>
                        <th>è§’è‰²</th>
                        <th>CPU</th>
                        <th>å†…å­˜</th>
                        <th>Pods</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="card node-detail" id="node-detail">
                <div>
                  <h2>NODE DETAIL</h2>
                  <p class="subtitle">é€‰æ‹©å·¦ä¾§èŠ‚ç‚¹ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                </div>
                <div id="node-detail-content">
                  <p class="subtitle">æš‚æœªé€‰æ‹©èŠ‚ç‚¹</p>
                </div>
              </div>
            </div>
          </section>

          <section class="view" data-view="deployments">
            <div class="deploys-grid">
              <div class="card deploy-card">
                <div>
                  <h2>DEPLOYMENT LIST</h2>
                  <p class="subtitle">è·Ÿè¸ªéƒ¨ç½²ç‰ˆæœ¬ï¼ŒæŒæ¡å‰¯æœ¬å¥åº·æƒ…å†µ</p>
                </div>
                <div class="table-toolbar">
                  <span class="table-hint" id="deployment-count" data-default="æŒ‰åç§°ã€å‘½åç©ºé—´æˆ–çŠ¶æ€ç­›é€‰ Deployment">æŒ‰åç§°ã€å‘½åç©ºé—´æˆ–çŠ¶æ€ç­›é€‰ Deployment</span>
                  <input type="search" id="deployment-search" class="search-input" placeholder="æœç´¢ Deployment..." />
                </div>
                <div id="deployments-feedback" class="feedback-box"></div>
                <div class="table-wrapper">
                  <table class="deploy-table" id="deploy-table">
                    <thead>
                      <tr>
                        <th>åç§°</th>
                        <th>å‘½åç©ºé—´</th>
                        <th>å°±ç»ª/æœŸæœ›</th>
                        <th>æ›´æ–°ä¸­</th>
                        <th>ç­–ç•¥</th>
                        <th>é•œåƒ</th>
                        <th>çŠ¶æ€</th>
                        <th>å­˜åœ¨æ—¶é—´</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="card deploy-detail" id="deploy-detail">
                <div>
                  <h2>DEPLOYMENT DETAIL</h2>
                  <p class="subtitle">é€‰æ‹©å·¦ä¾§ Deployment æŸ¥çœ‹è¯¦æƒ…ä¸æ‰©ç¼©å®¹</p>
                </div>
                <div id="deploy-detail-content">
                  <p class="subtitle">æš‚æœªé€‰æ‹© Deployment</p>
                </div>
              </div>
            </div>
          </section>

          <section class="view" data-view="services">
            <div class="services-grid">
              <div class="card service-card">
                <div>
                  <h2>SERVICE LIST</h2>
                  <p class="subtitle">æŒæ¡æœåŠ¡å…¥å£ã€ç«¯å£æ˜ å°„ä¸æ ¸å¿ƒ Pod</p>
                </div>
                <div class="table-toolbar">
                  <span class="table-hint" id="service-count" data-default="æŒ‰åç§°ã€å‘½åç©ºé—´æˆ–ç±»å‹å¿«é€Ÿå®šä½ Service">æŒ‰åç§°ã€å‘½åç©ºé—´æˆ–ç±»å‹å¿«é€Ÿå®šä½ Service</span>
                  <input type="search" id="service-search" class="search-input" placeholder="æœç´¢ Service..." />
                </div>
                <div id="services-feedback" class="feedback-box"></div>
                <div class="table-wrapper">
                  <table class="service-table" id="service-table">
                    <thead>
                      <tr>
                        <th>åç§°</th>
                        <th>å‘½åç©ºé—´</th>
                        <th>ç±»å‹</th>
                        <th>Cluster IP</th>
                        <th>å¤–éƒ¨ IP</th>
                        <th>ç«¯å£</th>
                        <th>å­˜åœ¨æ—¶é—´</th>
                        <th>çŠ¶æ€</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="card service-detail" id="service-detail">
                <div>
                  <h2>SERVICE DETAIL</h2>
                  <p class="subtitle">é€‰æ‹©å·¦ä¾§ Service æŸ¥çœ‹ç«¯å£ä¸å…³è”å¯¹è±¡</p>
                </div>
                <div id="service-detail-content">
                  <p class="subtitle">æš‚æœªé€‰æ‹© Service</p>
                </div>
              </div>
            </div>
          </section>

          <section class="view" data-view="pods">
            <div class="pods-grid">
              <div class="card pod-card">
                <div>
                  <h2>POD LIST</h2>
                  <p class="subtitle">æŸ¥çœ‹å„å‘½åç©ºé—´çš„ Pod çŠ¶æ€ä¸è°ƒåº¦ä¿¡æ¯</p>
                </div>
                <div class="table-toolbar">
                  <span class="table-hint" id="pod-count" data-default="æŒ‰åç§°ã€å‘½åç©ºé—´æˆ–èŠ‚ç‚¹è¿‡æ»¤ Pod">æŒ‰åç§°ã€å‘½åç©ºé—´æˆ–èŠ‚ç‚¹è¿‡æ»¤ Pod</span>
                  <input type="search" id="pod-search" class="search-input" placeholder="æœç´¢ Pod..." />
                </div>
                <div id="pods-feedback" class="feedback-box"></div>
                <div class="table-wrapper">
                  <table class="pod-table" id="pod-table">
                    <thead>
                      <tr>
                        <th>åç§°</th>
                        <th>å‘½åç©ºé—´</th>
                        <th>çŠ¶æ€</th>
                        <th>å®¹å™¨</th>
                        <th>é‡å¯æ¬¡æ•°</th>
                        <th>èŠ‚ç‚¹</th>
                        <th>å­˜åœ¨æ—¶é—´</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="card pod-detail" id="pod-detail">
                <div>
                  <h2>POD DETAIL</h2>
                  <p class="subtitle">é€‰æ‹©å·¦ä¾§ Pod æŸ¥çœ‹å®¹å™¨çŠ¶æ€ä¸æ—¥å¿—</p>
                </div>
                <div id="pod-detail-content">
                  <p class="subtitle">æš‚æœªé€‰æ‹© Pod</p>
                </div>
              </div>
            </div>
          </section>

          <section class="view" data-view="logs">
            <div class="logs-grid">
              <div class="card log-card">
                <div>
                  <h2>LIVE LOG STREAM</h2>
                  <p class="subtitle">å®æ—¶æ´å¯Ÿ Pod æ—¥å¿—è¾“å‡ºï¼Œæ”¯æŒæŒ‰ç»´åº¦ç­›é€‰</p>
                </div>
                <div class="filter-bar">
                  <select class="filter-select" id="log-namespace-filter">
                    <option value="">å…¨éƒ¨å‘½åç©ºé—´</option>
                  </select>
                  <select class="filter-select" id="log-pod-filter">
                    <option value="">å…¨éƒ¨ Pod</option>
                  </select>
                  <select class="filter-select" id="log-level-filter">
                    <option value="">å…¨éƒ¨çº§åˆ«</option>
                  </select>
                  <label class="auto-scroll-toggle">
                    <input type="checkbox" id="log-autoscroll" checked />
                    è‡ªåŠ¨æ»šåŠ¨
                  </label>
                </div>
                <div id="logs-feedback" class="feedback-box"></div>
                <div class="table-wrapper log-table-wrapper">
                  <table class="log-table" id="log-table">
                    <thead>
                      <tr>
                        <th>æ—¶é—´</th>
                        <th>å‘½åç©ºé—´</th>
                        <th>Pod</th>
                        <th>çº§åˆ«</th>
                        <th>æ¶ˆæ¯</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="card events-card">
                <div>
                  <h2>EVENT STREAM</h2>
                  <p class="subtitle">æŸ¥çœ‹æœ€æ–°äº‹ä»¶ä¸åŸå› ï¼Œå¿«é€Ÿé”å®šå¼‚å¸¸ä¿¡å·</p>
                </div>
                <div id="events-feedback" class="feedback-box"></div>
                <button type="button" class="view-events-button" id="events-launch-button">æŸ¥çœ‹äº‹ä»¶</button>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div class="modal" id="events-modal" role="dialog" aria-modal="true" hidden>
      <div class="modal-body">
        <div class="modal-header">
          <h2 id="events-modal-title">äº‹ä»¶åˆ—è¡¨</h2>
          <button type="button" class="modal-close" id="events-modal-close">å…³é—­</button>
        </div>
        <ul class="event-timeline" id="events-modal-list"></ul>
      </div>
    </div>

    <script>
      const viewMeta = {
        overview: {
          title: 'é›†ç¾¤æ¦‚è§ˆ',
          subtitle: 'å®æ—¶æŒæ¡é›†ç¾¤çŠ¶æ€ã€èµ„æºä½¿ç”¨ä¸å…³é”®äº‹ä»¶åŠ¨æ€'
        },
        namespaces: {
          title: 'å‘½åç©ºé—´ç®¡ç†',
          subtitle: 'åˆ›å»ºã€æµè§ˆå’Œç»´æŠ¤é›†ç¾¤ä¸­çš„èµ„æºéš”ç¦»è¾¹ç•Œ'
        },
        nodes: {
          title: 'èŠ‚ç‚¹ç®¡ç†',
          subtitle: 'å…³æ³¨èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€ï¼Œæ´å¯Ÿèµ„æºåˆ†å¸ƒä¸å¼‚å¸¸ä¿¡å·'
        },
        deployments: {
          title: 'éƒ¨ç½²ä¸å‘å¸ƒ',
          subtitle: 'ç›‘æ§ Deployment å‰¯æœ¬çŠ¶æ€å¹¶å¿«é€Ÿæ¨¡æ‹Ÿæ‰©ç¼©å®¹'
        },
        services: {
          title: 'æœåŠ¡ç®¡ç†',
          subtitle: 'æŒæ¡ Service æš´éœ²æ–¹å¼ä¸å…³è”å·¥ä½œè´Ÿè½½'
        },
        pods: {
          title: 'Pod ç®¡ç†',
          subtitle: 'æ’æŸ¥å®¹å™¨çŠ¶æ€ã€æŸ¥çœ‹æ—¥å¿—ä¸è°ƒåº¦äº‹ä»¶'
        },
        logs: {
          title: 'æ—¥å¿—ä¸äº‹ä»¶',
          subtitle: 'èšåˆå®æ—¶æ—¥å¿—ä¸äº‹ä»¶æµï¼Œæ´å¯Ÿé›†ç¾¤åŠ¨æ€'
        }
      };

      const navLinks = document.querySelectorAll('.menu a[data-view]');
      const views = document.querySelectorAll('.view');
      let activeView = 'overview';

      const themeToggleButton = document.getElementById('theme-toggle');
      const themeStorageKey = 'dashboard-theme';
      const themeIconSpan = themeToggleButton ? themeToggleButton.querySelector('.theme-icon') : null;
      const themeLabelSpan = document.getElementById('theme-label');

      let namespacesCache = [];
      let nodesCache = [];
      let activeNode = null;
      let deploymentsCache = [];
      let activeDeployment = null;
      let servicesCache = [];
      let activeService = null;
      let podsCache = [];
      let activePod = null;
      let logsCache = [];
      let eventsCache = [];
      let logMetaCache = { namespaces: [], pods: [], levels: [] };
      let logAutoScroll = true;
      let kubeImportsCache = [];
      let eventsModalOpen = false;

      navLinks.forEach(link => {
        link.addEventListener('click', event => {
          event.preventDefault();
          const view = link.dataset.view;
          if (view) {
            switchView(view);
          }
        });
      });

      const namespaceSearchInput = document.getElementById('namespace-search');
      const nodeSearchInput = document.getElementById('node-search');
      const deploymentSearchInput = document.getElementById('deployment-search');
      const serviceSearchInput = document.getElementById('service-search');
      const podSearchInput = document.getElementById('pod-search');
      const namespaceCountHint = document.getElementById('namespace-count');
      const nodeCountHint = document.getElementById('node-count');
      const deploymentCountHint = document.getElementById('deployment-count');
      const serviceCountHint = document.getElementById('service-count');
      const podCountHint = document.getElementById('pod-count');
      const kubeImportInput = document.getElementById('kubeconfig-input');
      const kubeImportTrigger = document.getElementById('kubeconfig-trigger');
      const kubeImportList = document.getElementById('import-list');
      const kubeImportFeedback = document.getElementById('kubeconfig-feedback');
      const logNamespaceSelect = document.getElementById('log-namespace-filter');
      const logPodSelect = document.getElementById('log-pod-filter');
      const logLevelSelect = document.getElementById('log-level-filter');
      const logAutoscrollToggle = document.getElementById('log-autoscroll');
      const logTableBody = document.querySelector('#log-table tbody');
      const eventsLaunchButton = document.getElementById('events-launch-button');
      const eventsModal = document.getElementById('events-modal');
      const eventsModalTitle = document.getElementById('events-modal-title');
      const eventsModalList = document.getElementById('events-modal-list');
      const eventsModalClose = document.getElementById('events-modal-close');

      if (logNamespaceSelect) {
        logNamespaceSelect.addEventListener('change', () => {
          fetchLogs();
        });
      }

      if (logPodSelect) {
        logPodSelect.addEventListener('change', () => {
          fetchLogs();
        });
      }

      if (logLevelSelect) {
        logLevelSelect.addEventListener('change', () => {
          fetchLogs();
        });
      }

      if (logAutoscrollToggle) {
        logAutoscrollToggle.addEventListener('change', event => {
          logAutoScroll = Boolean(event.target.checked);
        });
      }

      if (namespaceSearchInput) {
        const refresh = () => refreshNamespaceTable({ announce: true });
        namespaceSearchInput.addEventListener('input', refresh);
        namespaceSearchInput.addEventListener('search', refresh);
      }

      if (nodeSearchInput) {
        const refresh = () => refreshNodesTable({ announce: true });
        nodeSearchInput.addEventListener('input', refresh);
        nodeSearchInput.addEventListener('search', refresh);
      }

      if (deploymentSearchInput) {
        const refresh = () => refreshDeploymentsTable({ announce: true });
        deploymentSearchInput.addEventListener('input', refresh);
        deploymentSearchInput.addEventListener('search', refresh);
      }

      if (serviceSearchInput) {
        const refresh = () => refreshServicesTable({ announce: true });
        serviceSearchInput.addEventListener('input', refresh);
        serviceSearchInput.addEventListener('search', refresh);
      }

      if (podSearchInput) {
        const refresh = () => refreshPodsTable({ announce: true });
        podSearchInput.addEventListener('input', refresh);
        podSearchInput.addEventListener('search', refresh);
      }

      if (kubeImportTrigger && kubeImportInput) {
        kubeImportTrigger.addEventListener('click', () => {
          kubeImportInput.value = '';
          kubeImportInput.click();
        });

        kubeImportInput.addEventListener('change', () => {
          const [file] = kubeImportInput.files || [];
          if (!file) {
            return;
          }
          handleKubeconfigUpload(file);
        });
      }

      if (eventsLaunchButton) {
        eventsLaunchButton.addEventListener('click', async () => {
          try {
            showEventsFeedback('æ­£åœ¨åŠ è½½äº‹ä»¶...', true);
            await loadEvents({ silent: true });
            showEventsFeedback('äº‹ä»¶åŠ è½½å®Œæˆ', true);
            openEventsModal('é›†ç¾¤äº‹ä»¶æµ', eventsCache);
          } catch {
            // loadEvents å·²å¤„ç†æç¤º
          }
        });
      }

      if (eventsModalClose) {
        eventsModalClose.addEventListener('click', closeEventsModal);
      }

      if (eventsModal) {
        eventsModal.addEventListener('click', event => {
          if (event.target === eventsModal) {
            closeEventsModal();
          }
        });
      }

      document.addEventListener('keydown', event => {
        if (event.key === 'Escape' && eventsModalOpen) {
          closeEventsModal();
        }
      });

      function escapeHtml(str) {
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      function formatRelativeTime(timestamp) {
        if (!timestamp) {
          return '-';
        }
        const date = new Date(timestamp);
        if (Number.isNaN(date.getTime())) {
          return '-';
        }
        const diff = Date.now() - date.getTime();
        if (diff <= 0) {
          return 'åˆšåˆš';
        }
        const minutes = Math.floor(diff / 60000);
        if (minutes < 1) {
          return 'åˆšåˆš';
        }
        if (minutes < 60) {
          return `${minutes} åˆ†é’Ÿå‰`;
        }
        const hours = Math.floor(minutes / 60);
        if (hours < 24) {
          return `${hours} å°æ—¶å‰`;
        }
        const days = Math.floor(hours / 24);
        return `${days} å¤©å‰`;
      }

      function getSearchTerm(input) {
        if (!input || typeof input.value !== 'string') {
          return '';
        }
        return input.value.trim().toLowerCase();
      }

      function matchesTerm(values, term) {
        if (!term) {
          return true;
        }
        for (const value of values) {
          if (value == null) {
            continue;
          }
          if (Array.isArray(value)) {
            if (matchesTerm(value, term)) {
              return true;
            }
            continue;
          }
          const normalized = String(value).toLowerCase();
          if (normalized.includes(term)) {
            return true;
          }
        }
        return false;
      }

      function updateCountHint(element, filtered, total, term) {
        if (!element) {
          return;
        }
        const base = element.dataset.default || '';
        if (!total) {
          element.textContent = base || 'æš‚æ— æ•°æ®';
          return;
        }
        if (!term) {
          element.textContent = base ? `${base}ï¼ˆå…± ${total} æ¡ï¼‰` : `å…± ${total} æ¡`;
        } else {
          element.textContent = `ç­›é€‰ç»“æœï¼š${filtered}/${total} æ¡`;
        }
      }

      function applyNamespaceFilter(list) {
        const term = getSearchTerm(namespaceSearchInput);
        if (!term) {
          return list;
        }
        return list.filter(ns => {
          const labels = ns.labels ? Object.entries(ns.labels).map(([k, v]) => `${k}=${v}`) : [];
          return matchesTerm([
            ns.name,
            ns.status,
            ns.age,
            ns.createdAt,
            labels.join(' ')
          ], term);
        });
      }

      function applyNodeFilter(list) {
        const term = getSearchTerm(nodeSearchInput);
        if (!term) {
          return list;
        }
        return list.filter(node => {
          const roles = (node.roles || []).join(' ');
          const cpu = `${node.cpu.used}/${node.cpu.capacity}`;
          const mem = `${node.memory.used}/${node.memory.capacity}`;
          const pods = `${node.pods.running + node.pods.pending}/${node.pods.capacity}`;
          return matchesTerm([
            node.name,
            node.status,
            roles,
            cpu,
            mem,
            pods
          ], term);
        });
      }

      function applyDeploymentFilter(list) {
        const term = getSearchTerm(deploymentSearchInput);
        if (!term) {
          return list;
        }
        return list.filter(dep => {
          const images = (dep.images || []).join(' ');
          const ready = `${dep.readyReplicas}/${dep.desiredReplicas}`;
          return matchesTerm([
            dep.name,
            dep.namespace,
            dep.status,
            dep.strategy,
            dep.age,
            ready,
            images
          ], term);
        });
      }

      function applyServiceFilter(list) {
        const term = getSearchTerm(serviceSearchInput);
        if (!term) {
          return list;
        }
        return list.filter(service => {
          const ports = (service.ports || [])
            .map(port => `${port.name || ''} ${port.port}/${port.protocol || ''} ${port.nodePort || ''}`)
            .join(' ');
          const externalIPs = (service.externalIPs || []).join(' ');
          return matchesTerm([
            service.name,
            service.namespace,
            service.type,
            service.status,
            service.clusterIP,
            externalIPs,
            ports
          ], term);
        });
      }

      function applyPodFilter(list) {
        const term = getSearchTerm(podSearchInput);
        if (!term) {
          return list;
        }
        return list.filter(pod => {
          const images = (pod.images || []).join(' ');
          return matchesTerm([
            pod.name,
            pod.namespace,
            pod.status,
            pod.node,
            pod.readyContainers,
            pod.age,
            images
          ], term);
        });
      }

      function refreshNamespaceTable({ announce = false } = {}) {
        const term = getSearchTerm(namespaceSearchInput);
        const filtered = applyNamespaceFilter(namespacesCache);
        renderNamespaces(filtered);
        updateCountHint(namespaceCountHint, filtered.length, namespacesCache.length, term);
        if (announce) {
          const total = namespacesCache.length;
          const message = term
            ? `ç­›é€‰å‘½åç©ºé—´ï¼š${filtered.length}/${total}`
            : `å…± ${total} æ¡å‘½åç©ºé—´`;
          showNamespaceFeedback(message, true);
        }
      }

      function refreshNodesTable({ announce = false } = {}) {
        const term = getSearchTerm(nodeSearchInput);
        const filtered = applyNodeFilter(nodesCache);
        renderNodesTable(filtered);
        highlightNodeSelection();
        updateCountHint(nodeCountHint, filtered.length, nodesCache.length, term);
        if (announce) {
          const total = nodesCache.length;
          const message = term ? `ç­›é€‰èŠ‚ç‚¹ï¼š${filtered.length}/${total}` : `å…± ${total} å°èŠ‚ç‚¹`;
          showNodesFeedback(message, true);
        }
      }

      function refreshDeploymentsTable({ announce = false } = {}) {
        const term = getSearchTerm(deploymentSearchInput);
        const filtered = applyDeploymentFilter(deploymentsCache);
        renderDeploymentsTable(filtered);
        highlightDeploymentSelection();
        updateCountHint(deploymentCountHint, filtered.length, deploymentsCache.length, term);
        if (announce) {
          const total = deploymentsCache.length;
          const message = term ? `ç­›é€‰ Deploymentï¼š${filtered.length}/${total}` : `å…± ${total} ä¸ª Deployment`;
          showDeploymentsFeedback(message, true);
        }
      }

      function refreshServicesTable({ announce = false } = {}) {
        const term = getSearchTerm(serviceSearchInput);
        const filtered = applyServiceFilter(servicesCache);
        renderServicesTable(filtered);
        highlightServiceSelection();
        updateCountHint(serviceCountHint, filtered.length, servicesCache.length, term);
        if (announce) {
          const total = servicesCache.length;
          const message = term ? `ç­›é€‰ Serviceï¼š${filtered.length}/${total}` : `å…± ${total} ä¸ª Service`;
          showServicesFeedback(message, true);
        }
      }

      function refreshPodsTable({ announce = false } = {}) {
        const term = getSearchTerm(podSearchInput);
        const filtered = applyPodFilter(podsCache);
        renderPodsTable(filtered);
        highlightPodSelection();
        updateCountHint(podCountHint, filtered.length, podsCache.length, term);
        if (announce) {
          const total = podsCache.length;
          const message = term ? `ç­›é€‰ Podï¼š${filtered.length}/${total}` : `å…± ${total} ä¸ª Pod`;
          showPodsFeedback(message, true);
        }
      }

      function switchView(view) {
        if (activeView === view) {
          return;
        }

        navLinks.forEach(link => {
          link.classList.toggle('active', link.dataset.view === view);
        });

        views.forEach(section => {
          section.classList.toggle('active', section.dataset.view === view);
        });

        const meta = viewMeta[view] || viewMeta.overview;
        document.getElementById('view-title').textContent = meta.title;
        document.getElementById('view-subtitle').textContent = meta.subtitle;

        activeView = view;
        handleManualRefresh({ silent: true });
      }

      function updateThemeToggleLabel(theme) {
        if (!themeToggleButton) {
          return;
        }
        const isDark = theme === 'dark';
        const icon = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        const currentLabel = isDark ? 'æ˜Ÿå¤œæ¨¡å¼' : 'æ—¥å…‰æ¨¡å¼';
        const actionLabel = isDark ? 'åˆ‡æ¢ä¸ºæ—¥å…‰æ¨¡å¼' : 'åˆ‡æ¢ä¸ºæ˜Ÿå¤œæ¨¡å¼';
        if (themeIconSpan) {
          themeIconSpan.textContent = icon;
        }
        if (themeLabelSpan) {
          themeLabelSpan.textContent = `å½“å‰ï¼š${currentLabel}`;
        }
        themeToggleButton.setAttribute('aria-label', actionLabel);
        themeToggleButton.setAttribute('title', actionLabel);
      }

      function applyTheme(theme, { persist = true } = {}) {
        const nextTheme = theme === 'dark' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', nextTheme);
        if (persist) {
          try {
            window.localStorage.setItem(themeStorageKey, nextTheme);
          } catch (err) {
            /* å¿½ç•¥å†™å…¥å¤±è´¥ */
          }
        }
        updateThemeToggleLabel(nextTheme);
      }

      function detectInitialTheme() {
        const attr = document.documentElement.getAttribute('data-theme');
        if (attr === 'dark' || attr === 'light') {
          return attr;
        }
        return 'light';
      }

      updateThemeToggleLabel(detectInitialTheme());

      if (themeToggleButton) {
        themeToggleButton.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme');
          const next = current === 'dark' ? 'light' : 'dark';
          applyTheme(next, { persist: true });
        });
      }

      if (window.matchMedia) {
        const media = window.matchMedia('(prefers-color-scheme: dark)');
        const handleChange = event => {
          let stored = null;
          try {
            stored = window.localStorage.getItem(themeStorageKey);
          } catch (err) {
            stored = null;
          }
          if (stored === 'light' || stored === 'dark') {
            return;
          }
          applyTheme(event.matches ? 'dark' : 'light', { persist: false });
        };
        if (media.addEventListener) {
          media.addEventListener('change', handleChange);
        } else if (media.addListener) {
          media.addListener(handleChange);
        }
      }

      async function fetchOverview() {
        try {
          const res = await fetch('/api/cluster/overview', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          renderOverview(data);
          hideError();
        } catch (err) {
          showError(`å‘€ï¼Œè·å–æ¦‚è§ˆå¤±è´¥å•¦ï¼š${err.message}`);
        }
      }

      function renderOverview(data) {
        renderInfo(data.info);
        renderUsage(data.resourceUsage);
        renderEvents(data.recentEvents);
        document.getElementById('last-updated').textContent = `æœ€è¿‘æ›´æ–°ï¼š${new Date().toLocaleString()}`;
      }

      function renderInfo(info) {
        const list = document.querySelector('#cluster-info .info-list');
        list.innerHTML = '';
        const entries = [
          ['é›†ç¾¤åç§°', info.name],
          ['ç‰ˆæœ¬', info.version],
          ['èŠ‚ç‚¹æ•°', info.nodeCount],
          ['å‘½åç©ºé—´', info.namespaceCount],
          ['è¿è¡Œä¸­çš„ Pod', info.runningPodCount],
          ['ç­‰å¾…ä¸­çš„ Pod', info.pendingPodCount],
          ['å¤±è´¥çš„ Pod', info.failedPodCount],
          ['æ€» Pod å®¹é‡', info.totalPodCapacity]
        ];

        for (const [label, value] of entries) {
          const item = document.createElement('li');
          item.className = 'info-item';
          item.innerHTML = `<span>${label}</span><span>${value}</span>`;
          list.appendChild(item);
        }
      }

      function renderUsage(usage) {
        const container = document.querySelector('#resource-usage .metrics');
        container.innerHTML = '';
        for (const [key, metric] of Object.entries(usage)) {
          const percent = metric.total ? Math.min(100, Math.round((metric.used / metric.total) * 100)) : 0;
          const wrapper = document.createElement('div');
          wrapper.className = 'metric';
          wrapper.innerHTML = `
            <div class="label">${key.toUpperCase()} Â· ${metric.used} / ${metric.total} ${metric.unit}</div>
            <div class="metric-bar"><span style="width: ${percent}%"></span></div>
            <small class="label">é‡‡æ ·æ—¶é—´ï¼š${metric.timestamp}</small>
          `;
          container.appendChild(wrapper);
        }
      }

      function renderEvents(events) {
        const container = document.querySelector('#recent-events .events');
        container.innerHTML = '';
        if (!events || events.length === 0) {
          container.innerHTML = '<p class="label">æš‚æ— äº‹ä»¶</p>';
          return;
        }

        for (const event of events) {
          const wrapper = document.createElement('div');
          wrapper.className = `event ${event.type.toLowerCase()}`;
          wrapper.innerHTML = `
            <div class="title">${event.reason}</div>
            <div class="message">${event.message}</div>
            <div class="footer">
              <span>${event.object}</span>
              <span>${event.timestamp}</span>
            </div>
          `;
          container.appendChild(wrapper);
        }
      }

      function showError(message) {
        const errorBox = document.getElementById('error');
        errorBox.textContent = message;
        errorBox.style.display = 'block';
      }

      function hideError() {
        const errorBox = document.getElementById('error');
        errorBox.style.display = 'none';
      }

      async function fetchNamespaces() {
        try {
          const res = await fetch('/api/namespaces', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          namespacesCache = Array.isArray(data) ? data : [];
          refreshNamespaceTable();
          showNamespaceFeedback('å‘½åç©ºé—´åˆ—è¡¨å·²åˆ·æ–°', true);
        } catch (err) {
          showNamespaceFeedback(`å‘½åç©ºé—´åˆ—è¡¨è·å–å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderNamespaces(namespaces) {
        const tbody = document.querySelector('#namespace-table tbody');
        tbody.innerHTML = '';

        if (!namespaces || namespaces.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="6">ç›®å‰è¿˜æ²¡æœ‰å‘½åç©ºé—´è®°å½•</td>';
          tbody.appendChild(row);
          return;
        }

        namespaces.forEach(ns => {
          const row = document.createElement('tr');
          const labels = ns.labels
            ? Object.entries(ns.labels)
                .map(([k, v]) => `${escapeHtml(k)}=${escapeHtml(v)}`)
                .join('<br />')
            : '-';
          const createdAt = ns.createdAt ? escapeHtml(new Date(ns.createdAt).toLocaleString()) : '-';
          row.innerHTML = `
            <td>${escapeHtml(ns.name)}</td>
            <td>${escapeHtml(ns.status)}</td>
            <td>${escapeHtml(ns.age)}</td>
            <td>${createdAt}</td>
            <td>${labels}</td>
            <td><button type="button" data-action="delete" data-name="${escapeHtml(ns.name)}">åˆ é™¤</button></td>
          `;
          tbody.appendChild(row);
        });

        tbody.querySelectorAll('button[data-action="delete"]').forEach(btn => {
          btn.addEventListener('click', () => deleteNamespace(btn.dataset.name));
        });
      }

      async function deleteNamespace(name) {
        if (!name) {
          return;
        }

        try {
          const res = await fetch(`/api/namespaces/${encodeURIComponent(name)}`, {
            method: 'DELETE'
          });
          if (res.status === 204) {
            showNamespaceFeedback(`å‘½åç©ºé—´ ${name} å·²åˆ é™¤`, true);
            fetchNamespaces();
          } else if (res.status === 404) {
            showNamespaceFeedback(`å‘½åç©ºé—´ ${name} ä¸å­˜åœ¨`, false);
          } else {
            throw new Error(`çŠ¶æ€ç  ${res.status}`);
          }
        } catch (err) {
          showNamespaceFeedback(`åˆ é™¤å‘½åç©ºé—´å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      const namespaceForm = document.getElementById('namespace-form');
      namespaceForm.addEventListener('submit', async event => {
        event.preventDefault();
        const formData = new FormData(namespaceForm);
        const name = formData.get('name');
        const payload = { name };

        try {
          const res = await fetch('/api/namespaces', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (res.status === 201) {
            namespaceForm.reset();
            showNamespaceFeedback(`å‘½åç©ºé—´ ${name} åˆ›å»ºæˆåŠŸ`, true);
            fetchNamespaces();
          } else {
            const data = await res.json().catch(() => null);
            const message = data && data.error ? data.error : `è¯·æ±‚å¤±è´¥ï¼š${res.status}`;
            showNamespaceFeedback(message, false);
          }
        } catch (err) {
          showNamespaceFeedback(`åˆ›å»ºå‘½åç©ºé—´å¤±è´¥ï¼š${err.message}`, false);
        }
      });

      function showNamespaceFeedback(message, success) {
        const box = document.getElementById('namespace-feedback');
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      async function handleKubeconfigUpload(file) {
        const formData = new FormData();
        formData.append('file', file);

        try {
          const res = await fetch('/api/cluster/import', {
            method: 'POST',
            body: formData
          });
          if (!res.ok) {
            const text = await res.text();
            throw new Error(text || `è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const summary = await res.json();
          showImportFeedback(`å¯¼å…¥æˆåŠŸï¼š${summary.name || file.name}`, true);
          await fetchClusterImports({ silent: true });
        } catch (err) {
          showImportFeedback(`å¯¼å…¥å¤±è´¥ï¼š${err.message}`, false);
        } finally {
          if (kubeImportInput) {
            kubeImportInput.value = '';
          }
        }
      }

      function showImportFeedback(message, success) {
        if (!kubeImportFeedback) {
          return;
        }
        kubeImportFeedback.textContent = message;
        kubeImportFeedback.classList.remove('success', 'error');
        kubeImportFeedback.classList.add(success ? 'success' : 'error');
        kubeImportFeedback.style.display = 'block';
      }

      async function fetchClusterImports({ silent = false } = {}) {
        if (!kubeImportList) {
          return;
        }
        try {
          const res = await fetch('/api/cluster/imports', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          kubeImportsCache = Array.isArray(data) ? data : [];
          renderClusterImports(kubeImportsCache);
          if (!silent) {
            showImportFeedback(`å·²åŒæ­¥ ${kubeImportsCache.length} æ¡å¯¼å…¥è®°å½•`, true);
          }
        } catch (err) {
          showImportFeedback(`è·å–å¯¼å…¥è®°å½•å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderClusterImports(imports) {
        if (!kubeImportList) {
          return;
        }

        kubeImportList.innerHTML = '';

        if (!imports || imports.length === 0) {
          const li = document.createElement('li');
          li.innerHTML = '<strong>å°šæœªå¯¼å…¥é›†ç¾¤</strong><small>ä¸Šä¼  kubeconfig æ–‡ä»¶åï¼Œè¿™é‡Œä¼šå±•ç¤ºè§£æç»“æœ</small>';
          kubeImportList.appendChild(li);
          return;
        }

        imports.forEach(item => {
          const li = document.createElement('li');
          const clusterCount = (item.clusters || []).length;
          const contextCount = (item.contexts || []).length;
          const importedAt = item.importedAt ? new Date(item.importedAt).toLocaleString() : 'æœªçŸ¥æ—¶é—´';
          li.innerHTML = `
            <strong>${escapeHtml(item.name || 'æœªå‘½åé›†ç¾¤')}</strong>
            <small>é›†ç¾¤ ${clusterCount} Â· ä¸Šä¸‹æ–‡ ${contextCount} Â· å½“å‰ ${escapeHtml(item.currentContext || 'æœªæŒ‡å®š')}</small>
            <small>å¯¼å…¥æ—¶é—´ï¼š${escapeHtml(importedAt)}</small>
          `;
          kubeImportList.appendChild(li);
        });
      }

      async function fetchNodes({ retainSelection = false } = {}) {
        try {
          const res = await fetch('/api/nodes', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          nodesCache = Array.isArray(data) ? data : [];

          if (!retainSelection || !activeNode || !nodesCache.find(n => n.name === activeNode)) {
            activeNode = nodesCache.length ? nodesCache[0].name : null;
          }

          refreshNodesTable();

          if (activeNode) {
            await fetchNodeDetail(activeNode, { silent: true });
          } else {
            renderNodeDetail(null);
          }

          showNodesFeedback('èŠ‚ç‚¹åˆ—è¡¨å·²åˆ·æ–°', true);
        } catch (err) {
          showNodesFeedback(`èŠ‚ç‚¹åˆ—è¡¨è·å–å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderNodesTable(nodes) {
        const tbody = document.querySelector('#node-table tbody');
        tbody.innerHTML = '';

        if (!nodes || nodes.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="6">æš‚æœªå‘ç°èŠ‚ç‚¹</td>';
          tbody.appendChild(row);
          return;
        }

        nodes.forEach(node => {
          const row = document.createElement('tr');
          row.dataset.name = node.name;
          row.className = node.name === activeNode ? 'active' : '';
          const roles = (node.roles || []).join(', ') || 'æœªçŸ¥';
          const cpuUsage = `${node.cpu.used}/${node.cpu.capacity} ${node.cpu.unit} (${node.cpu.percentage}%)`;
          const memoryUsage = `${node.memory.used}/${node.memory.capacity} ${node.memory.unit} (${node.memory.percentage}%)`;
          const podsUsage = `${node.pods.running + node.pods.pending}/${node.pods.capacity}`;
          row.innerHTML = `
            <td>${escapeHtml(node.name)}</td>
            <td>${escapeHtml(node.status)}</td>
            <td>${escapeHtml(roles)}</td>
            <td>${escapeHtml(cpuUsage)}</td>
            <td>${escapeHtml(memoryUsage)}</td>
            <td>${escapeHtml(podsUsage)}</td>
          `;
          row.addEventListener('click', () => {
            activeNode = node.name;
            highlightNodeSelection();
            fetchNodeDetail(node.name);
          });
          tbody.appendChild(row);
        });
      }

      function highlightNodeSelection() {
        document.querySelectorAll('#node-table tbody tr').forEach(row => {
          row.classList.toggle('active', row.dataset.name === activeNode);
        });
      }

      async function fetchNodeDetail(name, { silent = false } = {}) {
        if (!name) {
          renderNodeDetail(null);
          return;
        }

        try {
          const res = await fetch(`/api/nodes/${encodeURIComponent(name)}`, { cache: 'no-store' });
          if (!res.ok) {
            if (res.status === 404) {
              throw new Error('èŠ‚ç‚¹ä¸å­˜åœ¨');
            }
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const detail = await res.json();
          renderNodeDetail(detail);
          if (!silent) {
            showNodesFeedback(`èŠ‚ç‚¹ ${name} è¯¦æƒ…å·²æ›´æ–°`, true);
          }
        } catch (err) {
          showNodesFeedback(`è·å–èŠ‚ç‚¹ ${name} è¯¦æƒ…å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderNodeDetail(detail) {
        const container = document.getElementById('node-detail-content');
        if (!detail) {
          container.innerHTML = '<p class="subtitle">æš‚æœªé€‰æ‹©èŠ‚ç‚¹</p>';
          return;
        }

        const statusClass = detail.status.toLowerCase() === 'ready' ? 'ready' : detail.status.toLowerCase() === 'notready' ? 'notready' : 'unknown';
        const roles = (detail.roles || []).join(', ') || 'æœªè®¾ç½®';

        const labelList = detail.labels
          ? Object.entries(detail.labels)
              .map(([k, v]) => `<li>${k} = ${v}</li>`)
              .join('')
          : '';

        const taints = detail.taints && detail.taints.length
          ? detail.taints.map(t => `<li>${t}</li>`).join('')
          : '<li>æ— æ±¡ç‚¹</li>';

        const conditions = detail.conditions && detail.conditions.length
          ? detail.conditions
              .map(
                c => `
                  <li>
                    <strong>${c.type} Â· ${c.status}</strong>
                    <small>${c.message}</small>
                    <small>æœ€è¿‘å¿ƒè·³ï¼š${new Date(c.lastHeartbeat).toLocaleString()}</small>
                  </li>
                `
              )
              .join('')
          : '<li>æš‚æ— æ¡ä»¶ä¿¡æ¯</li>';

        container.innerHTML = `
          <div class="detail-header">
            <h3>${detail.name}</h3>
            <span class="badge ${statusClass}">${detail.status}</span>
          </div>
          <div class="detail-meta">
            <div class="item">
              <strong>è§’è‰²</strong>
              <span>${roles}</span>
            </div>
            <div class="item">
              <strong>å­˜åœ¨æ—¶é—´</strong>
              <span>${detail.age}</span>
            </div>
            <div class="item">
              <strong>Kubelet</strong>
              <span>${detail.kubeletVersion}</span>
            </div>
            <div class="item">
              <strong>å®¹å™¨è¿è¡Œæ—¶</strong>
              <span>${detail.containerRuntime}</span>
            </div>
            <div class="item">
              <strong>æ“ä½œç³»ç»Ÿ</strong>
              <span>${detail.osImage}</span>
            </div>
            <div class="item">
              <strong>å†…æ ¸</strong>
              <span>${detail.kernelVersion}</span>
            </div>
          </div>
          <div class="detail-metrics">
            <div class="metric-pill">
              <strong>CPU</strong>
              <span>${detail.cpu.used} / ${detail.cpu.capacity} ${detail.cpu.unit}ï¼ˆ${detail.cpu.percentage}%ï¼‰</span>
            </div>
            <div class="metric-pill">
              <strong>å†…å­˜</strong>
              <span>${detail.memory.used} / ${detail.memory.capacity} ${detail.memory.unit}ï¼ˆ${detail.memory.percentage}%ï¼‰</span>
            </div>
            <div class="metric-pill">
              <strong>Pods</strong>
              <span>è¿è¡Œä¸­ ${detail.pods.running} Â· ç­‰å¾…ä¸­ ${detail.pods.pending} Â· å®¹é‡ ${detail.pods.capacity}</span>
            </div>
          </div>
          <div class="detail-section">
            <h3>æ ‡ç­¾</h3>
            <ul>${labelList || '<li>æš‚æ— æ ‡ç­¾</li>'}</ul>
          </div>
          <div class="detail-section">
            <h3>æ±¡ç‚¹</h3>
            <ul>${taints}</ul>
          </div>
          <div class="detail-section">
            <h3>èŠ‚ç‚¹æ¡ä»¶</h3>
            <ul>${conditions}</ul>
          </div>
        `;
      }

      function showNodesFeedback(message, success) {
        const box = document.getElementById('nodes-feedback');
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      async function fetchDeployments({ retainSelection = false } = {}) {
        try {
          const res = await fetch('/api/deployments', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          deploymentsCache = Array.isArray(data) ? data : [];

          if (!retainSelection || !activeDeployment || !deploymentsCache.find(d => d.name === activeDeployment)) {
            activeDeployment = deploymentsCache.length ? deploymentsCache[0].name : null;
          }

          refreshDeploymentsTable();

          if (activeDeployment) {
            await fetchDeploymentDetail(activeDeployment, { silent: true });
          } else {
            renderDeploymentDetail(null);
          }

          showDeploymentsFeedback('Deployment åˆ—è¡¨å·²åˆ·æ–°', true);
        } catch (err) {
          showDeploymentsFeedback(`è·å– Deployment åˆ—è¡¨å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderDeploymentsTable(deployments) {
        const tbody = document.querySelector('#deploy-table tbody');
        tbody.innerHTML = '';

        if (!deployments || deployments.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="8">æš‚æ—  Deployment è®°å½•</td>';
          tbody.appendChild(row);
          return;
        }

        deployments.forEach(dep => {
          const row = document.createElement('tr');
          row.dataset.name = dep.name;
          row.className = dep.name === activeDeployment ? 'active' : '';
          row.innerHTML = `
            <td>${escapeHtml(dep.name)}</td>
            <td>${escapeHtml(dep.namespace)}</td>
            <td>${dep.readyReplicas}/${dep.desiredReplicas}</td>
            <td>${dep.updatedReplicas}</td>
            <td>${escapeHtml(dep.strategy)}</td>
            <td>${(dep.images || []).map(escapeHtml).join('<br />')}</td>
            <td>${escapeHtml(dep.status || '')}</td>
            <td>${escapeHtml(dep.age || '-')}</td>
          `;
          row.addEventListener('click', () => {
            activeDeployment = dep.name;
            highlightDeploymentSelection();
            fetchDeploymentDetail(dep.name);
          });
          tbody.appendChild(row);
        });
      }

      function highlightDeploymentSelection() {
        document.querySelectorAll('#deploy-table tbody tr').forEach(row => {
          row.classList.toggle('active', row.dataset.name === activeDeployment);
        });
      }

      async function fetchDeploymentDetail(name, { silent = false } = {}) {
        if (!name) {
          renderDeploymentDetail(null);
          return;
        }

        try {
          const res = await fetch(`/api/deployments/${encodeURIComponent(name)}`, { cache: 'no-store' });
          if (!res.ok) {
            if (res.status === 404) {
              throw new Error('Deployment ä¸å­˜åœ¨');
            }
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const detail = await res.json();
          renderDeploymentDetail(detail);
          if (!silent) {
            showDeploymentsFeedback(`Deployment ${name} è¯¦æƒ…å·²æ›´æ–°`, true);
          }
        } catch (err) {
          showDeploymentsFeedback(`è·å– Deployment ${name} è¯¦æƒ…å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      async function scaleDeployment(name, replicas) {
        try {
          const res = await fetch(`/api/deployments/${encodeURIComponent(name)}/scale`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ replicas })
          });

          if (res.status === 200) {
            const detail = await res.json();
            renderDeploymentDetail(detail);
            showDeploymentsFeedback(`Deployment ${name} å‰¯æœ¬æ•°å·²æ›´æ–°ä¸º ${replicas}`, true);
            fetchDeployments({ retainSelection: true });
          } else {
            const data = await res.json().catch(() => null);
            const message = data && data.error ? data.error : `è¯·æ±‚å¤±è´¥ï¼š${res.status}`;
            showDeploymentsFeedback(message, false);
          }
        } catch (err) {
          showDeploymentsFeedback(`æ‰©ç¼©å®¹å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderDeploymentDetail(detail) {
        const container = document.getElementById('deploy-detail-content');
        if (!detail) {
          container.innerHTML = '<p class="subtitle">æš‚æœªé€‰æ‹© Deployment</p>';
          return;
        }

        const status = (detail.status || '').toLowerCase();
        let statusClass = 'unknown';
        if (status === 'healthy') {
          statusClass = 'ready';
        } else if (status === 'down') {
          statusClass = 'notready';
        }

        const labels = detail.labels && Object.keys(detail.labels).length
          ? Object.entries(detail.labels).map(([k, v]) => `<li>${escapeHtml(k)} = ${escapeHtml(v)}</li>`).join('')
          : '<li>æš‚æ— æ ‡ç­¾</li>';

        const selector = detail.selector && Object.keys(detail.selector).length
          ? Object.entries(detail.selector).map(([k, v]) => `<li>${escapeHtml(k)} = ${escapeHtml(v)}</li>`).join('')
          : '<li>æš‚æ— é€‰æ‹©å™¨</li>';

        const containers = detail.containers && detail.containers.length
          ? detail.containers
              .map(c => `
                <li>
                  <strong>${escapeHtml(c.name)}</strong>
                  <small>é•œåƒï¼š${escapeHtml(c.image)}</small>
                  <small>ç«¯å£ï¼š${(c.ports || []).length ? c.ports.join(', ') : 'æ— '}</small>
                </li>
              `)
              .join('')
          : '<li>æš‚æ— å®¹å™¨ä¿¡æ¯</li>';

        const conditions = detail.conditions && detail.conditions.length
          ? detail.conditions
              .map(c => `
                <li>
                  <strong>${escapeHtml(c.type)} Â· ${escapeHtml(c.status)}</strong>
                  <small>${escapeHtml(c.message || '')}</small>
                  <small>æœ€åæ›´æ–°ï¼š${escapeHtml(new Date(c.lastUpdate).toLocaleString())}</small>
                </li>
              `)
              .join('')
          : '<li>æš‚æ— æ¡ä»¶ä¿¡æ¯</li>';

        container.innerHTML = `
          <div class="detail-header">
            <h3>${escapeHtml(detail.name)}</h3>
            <span class="badge ${statusClass}">${escapeHtml(detail.status || '')}</span>
          </div>
          <form id="deploy-scale-form" class="deploy-form">
            <label for="deploy-scale-input">ç›®æ ‡å‰¯æœ¬æ•°</label>
            <input id="deploy-scale-input" name="replicas" type="number" min="0" max="200" value="${detail.desiredReplicas}" />
            <button type="submit">åº”ç”¨æ‰©ç¼©å®¹</button>
          </form>
          <div class="detail-meta">
            <div class="item">
              <strong>å‘½åç©ºé—´</strong>
              <span>${escapeHtml(detail.namespace)}</span>
            </div>
            <div class="item">
              <strong>å‰¯æœ¬æƒ…å†µ</strong>
              <span>å°±ç»ª ${detail.readyReplicas} Â· ç›®æ ‡ ${detail.desiredReplicas} Â· æ›´æ–°ä¸­ ${detail.updatedReplicas}</span>
            </div>
            <div class="item">
              <strong>ç­–ç•¥</strong>
              <span>${escapeHtml(detail.strategy || 'RollingUpdate')}</span>
            </div>
            <div class="item">
              <strong>é•œåƒç‰ˆæœ¬</strong>
              <span>${(detail.images || []).map(escapeHtml).join('<br />') || '-'}</span>
            </div>
            <div class="item">
              <strong>å½“å‰ä¿®è®¢</strong>
              <span>${detail.revision}</span>
            </div>
            <div class="item">
              <strong>æœ€åæ›´æ–°</strong>
              <span>${detail.lastUpdated ? new Date(detail.lastUpdated).toLocaleString() : 'æœªçŸ¥'}</span>
            </div>
          </div>
          <div class="detail-section">
            <h3>æ ‡ç­¾</h3>
            <ul>${labels}</ul>
          </div>
          <div class="detail-section">
            <h3>é€‰æ‹©å™¨</h3>
            <ul>${selector}</ul>
          </div>
          <div class="detail-section">
            <h3>å®¹å™¨æ¨¡æ¿</h3>
            <ul>${containers}</ul>
          </div>
          <div class="detail-section">
            <h3>æ¡ä»¶çŠ¶æ€</h3>
            <ul>${conditions}</ul>
          </div>
        `;

        const form = container.querySelector('#deploy-scale-form');
        form.addEventListener('submit', event => {
          event.preventDefault();
          const input = form.querySelector('#deploy-scale-input');
          const value = Number(input.value);
          if (Number.isNaN(value) || value < 0) {
            showDeploymentsFeedback('è¯·è¾“å…¥åˆæ³•çš„å‰¯æœ¬æ•°ï¼ˆå¤§äºç­‰äº 0ï¼‰', false);
            return;
          }
          scaleDeployment(detail.name, value);
        });
      }

      function showDeploymentsFeedback(message, success) {
        const box = document.getElementById('deployments-feedback');
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      async function fetchServices({ retainSelection = false } = {}) {
        try {
          const res = await fetch('/api/services', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          servicesCache = Array.isArray(data) ? data : [];

          if (!retainSelection || !activeService || !servicesCache.find(svc => svc.name === activeService)) {
            activeService = servicesCache.length ? servicesCache[0].name : null;
          }

          refreshServicesTable();

          if (activeService) {
            await fetchServiceDetail(activeService, { silent: true });
          } else {
            renderServiceDetail(null);
          }

          showServicesFeedback('æœåŠ¡åˆ—è¡¨å·²åˆ·æ–°', true);
        } catch (err) {
          showServicesFeedback(`æœåŠ¡åˆ—è¡¨è·å–å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderServicesTable(services) {
        const tbody = document.querySelector('#service-table tbody');
        if (!tbody) {
          return;
        }
        tbody.innerHTML = '';

        if (!services || services.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="8">æš‚æ—  Service è®°å½•</td>';
          tbody.appendChild(row);
          return;
        }

        services.forEach(service => {
          const row = document.createElement('tr');
          row.dataset.name = service.name;
          row.className = service.name === activeService ? 'active' : '';

          const ports = (service.ports || [])
            .map(port => {
              const label = port.name ? `${escapeHtml(port.name)} ` : '';
              const mapping = `${escapeHtml(String(port.port))}â†’${escapeHtml(String(port.targetPort))}/${escapeHtml(port.protocol || '-')}`;
              const node = port.nodePort != null ? ` Â· NodePort ${escapeHtml(String(port.nodePort))}` : '';
              return `${label}${mapping}${node}`;
            })
            .join('<br />') || '-';

          const externalIPs = (service.externalIPs || [])
            .map(ip => escapeHtml(ip))
            .join('<br />') || '-';

          row.innerHTML = `
            <td>${escapeHtml(service.name)}</td>
            <td>${escapeHtml(service.namespace)}</td>
            <td>${escapeHtml(service.type || '-')}</td>
            <td>${escapeHtml(service.clusterIP || '-')}</td>
            <td>${externalIPs}</td>
            <td>${ports}</td>
            <td>${escapeHtml(service.age || '-')}</td>
            <td>${escapeHtml(service.status || '-')}</td>
          `;

          row.addEventListener('click', () => {
            activeService = service.name;
            highlightServiceSelection();
            fetchServiceDetail(service.name);
          });

          tbody.appendChild(row);
        });
      }

      function highlightServiceSelection() {
        document.querySelectorAll('#service-table tbody tr').forEach(row => {
          row.classList.toggle('active', row.dataset.name === activeService);
        });
      }

      async function fetchServiceDetail(name, { silent = false } = {}) {
        if (!name) {
          renderServiceDetail(null);
          return;
        }

        try {
          const res = await fetch(`/api/services/${encodeURIComponent(name)}`, { cache: 'no-store' });
          if (!res.ok) {
            if (res.status === 404) {
              throw new Error('Service ä¸å­˜åœ¨');
            }
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const detail = await res.json();
          renderServiceDetail(detail);
          if (!silent) {
            showServicesFeedback(`Service ${name} è¯¦æƒ…å·²æ›´æ–°`, true);
          }
        } catch (err) {
          showServicesFeedback(`è·å– Service ${name} è¯¦æƒ…å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderServiceDetail(detail) {
        const container = document.getElementById('service-detail-content');
        if (!container) {
          return;
        }

        if (!detail) {
          container.innerHTML = '<p class="subtitle">æš‚æœªé€‰æ‹© Service</p>';
          return;
        }

        const status = (detail.status || '').toLowerCase();
        let statusClass = 'unknown';
        if (status === 'active' || status === 'ready') {
          statusClass = 'ready';
        } else if (status === 'pending' || status === 'degraded') {
          statusClass = 'notready';
        }

        const externalIPs = (detail.externalIPs || []).join('ï¼Œ') || 'æœªåˆ†é…';
        const createdAt = detail.createdAt ? new Date(detail.createdAt).toLocaleString() : 'æœªçŸ¥';

        const ports = detail.ports && detail.ports.length
          ? detail.ports
              .map(port => {
                const name = port.name ? `${escapeHtml(port.name)}` : 'æœªå‘½åç«¯å£';
                const node = port.nodePort != null ? ` Â· NodePort ${escapeHtml(String(port.nodePort))}` : '';
                return `
                  <li>
                    <strong>${name}</strong>
                    <small>${escapeHtml(port.protocol || '-')}: ${escapeHtml(String(port.port))} â†’ ${escapeHtml(String(port.targetPort))}${node}</small>
                  </li>
                `;
              })
              .join('')
          : '<li>æš‚æ— ç«¯å£ä¿¡æ¯</li>';

        const selectorChips = detail.selector && Object.keys(detail.selector || {}).length
          ? Object.entries(detail.selector)
              .map(([k, v]) => `<span class="chip">${escapeHtml(k)}=${escapeHtml(v)}</span>`)
              .join('')
          : '<span class="chip">æœªè®¾ç½®</span>';

        const endpoints = detail.endpoints && detail.endpoints.length
          ? detail.endpoints.map(ep => `<li>${escapeHtml(ep)}</li>`).join('')
          : '<li>æš‚æ—  Endpoint</li>';

        const related = detail.relatedPods && detail.relatedPods.length
          ? detail.relatedPods
              .map(pod => {
                const node = pod.node ? ` Â· èŠ‚ç‚¹ ${escapeHtml(pod.node)}` : '';
                return `
                  <li>
                    <strong>${escapeHtml(pod.name)}</strong>
                    <small>${escapeHtml(pod.namespace)} Â· ${escapeHtml(pod.status || 'æœªçŸ¥')}${node}</small>
                  </li>
                `;
              })
              .join('')
          : '<li>æš‚æ— å…³è” Pod</li>';

        container.innerHTML = `
          <div class="detail-header">
            <h3>${escapeHtml(detail.name)}</h3>
            <span class="badge ${statusClass}">${escapeHtml(detail.status || 'æœªçŸ¥')}</span>
          </div>
          <div class="detail-meta">
            <div class="item">
              <strong>å‘½åç©ºé—´</strong>
              <span>${escapeHtml(detail.namespace)}</span>
            </div>
            <div class="item">
              <strong>æœåŠ¡ç±»å‹</strong>
              <span>${escapeHtml(detail.type || '-')}</span>
            </div>
            <div class="item">
              <strong>Cluster IP</strong>
              <span>${escapeHtml(detail.clusterIP || '-')}</span>
            </div>
            <div class="item">
              <strong>å¤–éƒ¨ IP</strong>
              <span>${escapeHtml(externalIPs)}</span>
            </div>
            <div class="item">
              <strong>å­˜åœ¨æ—¶é—´</strong>
              <span>${escapeHtml(detail.age || '-')}</span>
            </div>
            <div class="item">
              <strong>åˆ›å»ºæ—¶é—´</strong>
              <span>${escapeHtml(createdAt)}</span>
            </div>
          </div>
          <div class="detail-section">
            <h3>ç«¯å£æ˜ å°„</h3>
            <ul>${ports}</ul>
          </div>
          <div class="detail-section">
            <h3>Selector</h3>
            <div class="chip-group">${selectorChips}</div>
          </div>
          <div class="detail-section">
            <h3>Endpoints</h3>
            <ul>${endpoints}</ul>
          </div>
          <div class="detail-section">
            <h3>å…³è” Pod</h3>
            <ul>${related}</ul>
          </div>
          <div class="detail-section">
            <h3>è¯´æ˜</h3>
            <p class="subtitle">${escapeHtml(detail.description || 'æš‚æ— æè¿°')}</p>
          </div>
        `;
      }

      function showServicesFeedback(message, success) {
        const box = document.getElementById('services-feedback');
        if (!box) {
          return;
        }
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      async function fetchLogMeta() {
        try {
          const res = await fetch('/api/logs/meta', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          const namespaces = Array.isArray(data.namespaces) ? data.namespaces : [];
          const pods = Array.isArray(data.pods) ? data.pods : [];
          const levels = Array.isArray(data.levels) ? data.levels : [];
          logMetaCache = { namespaces, pods, levels };
          renderLogFilters(logMetaCache);
        } catch (err) {
          showLogsFeedback(`è·å–æ—¥å¿—ç­›é€‰ä¿¡æ¯å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function updateSelectOptions(select, options, placeholder) {
        if (!select) {
          return;
        }
        const current = select.value;
        select.innerHTML = '';
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = placeholder;
        select.appendChild(defaultOption);

        (options || []).forEach(option => {
          const opt = document.createElement('option');
          opt.value = option;
          opt.textContent = option;
          select.appendChild(opt);
        });

        if (current && options && options.includes(current)) {
          select.value = current;
        }
      }

      function renderLogFilters(meta) {
        updateSelectOptions(logNamespaceSelect, meta.namespaces || [], 'å…¨éƒ¨å‘½åç©ºé—´');
        updateSelectOptions(logPodSelect, meta.pods || [], 'å…¨éƒ¨ Pod');

        if (logLevelSelect) {
          const levelOptions = (meta.levels || []).map(level => String(level));
          updateSelectOptions(logLevelSelect, levelOptions, 'å…¨éƒ¨çº§åˆ«');
        }
      }

      async function fetchLogs({ silent = false } = {}) {
        if (!logTableBody) {
          return;
        }

        const params = new URLSearchParams();
        if (logNamespaceSelect && logNamespaceSelect.value) {
          params.set('namespace', logNamespaceSelect.value);
        }
        if (logPodSelect && logPodSelect.value) {
          params.set('pod', logPodSelect.value);
        }
        if (logLevelSelect && logLevelSelect.value) {
          params.set('level', logLevelSelect.value);
        }
        params.set('limit', '100');

        const url = `/api/logs/stream${params.toString() ? `?${params.toString()}` : ''}`;

        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          logsCache = Array.isArray(data) ? data : [];
          renderLogTable(logsCache);
          if (!silent) {
            showLogsFeedback('æ—¥å¿—æµå·²åˆ·æ–°', true);
          }
        } catch (err) {
          showLogsFeedback(`è·å–æ—¥å¿—å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderLogTable(entries) {
        if (!logTableBody) {
          return;
        }

        logTableBody.innerHTML = '';

        if (!entries || entries.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="5">æš‚æ— æ—¥å¿—è®°å½•</td>';
          logTableBody.appendChild(row);
          return;
        }

        entries.forEach(entry => {
          const levelName = String(entry.level || '').toLowerCase();
          let levelClass = 'log-level-info';
          if (levelName === 'warn') {
            levelClass = 'log-level-warn';
          } else if (levelName === 'error') {
            levelClass = 'log-level-error';
          }

          const row = document.createElement('tr');
          const relative = formatRelativeTime(entry.timestamp);
          const absolute = entry.timestamp ? new Date(entry.timestamp).toLocaleString() : '-';
          row.innerHTML = `
            <td><span title="${escapeHtml(absolute)}">${escapeHtml(relative)}</span></td>
            <td>${escapeHtml(entry.namespace || '-')}</td>
            <td>${escapeHtml(entry.pod || '-')}</td>
            <td><span class="log-level-badge ${levelClass}">${escapeHtml(String(entry.level || '-'))}</span></td>
            <td>${escapeHtml(entry.message || '')}</td>
          `;
          logTableBody.appendChild(row);
        });

        if (logAutoScroll) {
          const wrapper = document.querySelector('.log-table-wrapper');
          if (wrapper) {
            wrapper.scrollTop = wrapper.scrollHeight;
          }
        }
      }

      function showLogsFeedback(message, success) {
        const box = document.getElementById('logs-feedback');
        if (!box) {
          return;
        }
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      async function loadEvents({ silent = false } = {}) {
        try {
          const res = await fetch('/api/events', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          eventsCache = Array.isArray(data) ? data : [];
          if (eventsModalOpen) {
            renderEventsList(eventsCache, eventsModalList);
          }
          if (!silent) {
            showEventsFeedback('äº‹ä»¶æµå·²åˆ·æ–°', true);
          }
          return eventsCache;
        } catch (err) {
          showEventsFeedback(`è·å–äº‹ä»¶å¤±è´¥ï¼š${err.message}`, false);
          throw err;
        }
      }

      function renderEventsList(events, container) {
        if (!container) {
          return;
        }

        container.innerHTML = '';

        if (!events || events.length === 0) {
          const item = document.createElement('li');
          item.innerHTML = '<p class="subtitle">æš‚æ— äº‹ä»¶æ•°æ®</p>';
          container.appendChild(item);
          return;
        }

        events.forEach(event => {
          const type = String(event.type || '').toLowerCase();
          const item = document.createElement('li');
          item.className = type === 'warning' ? 'warning' : 'normal';

          const when = formatRelativeTime(event.timestamp);
          const absolute = event.timestamp ? new Date(event.timestamp).toLocaleString() : '-';
          const countLabel = event.count ? ` Â· æ¬¡æ•° ${escapeHtml(String(event.count))}` : '';

          item.innerHTML = `
            <div class="detail-header">
              <h3>${escapeHtml(event.reason || 'äº‹ä»¶')}</h3>
              <span class="badge ${type === 'warning' ? 'notready' : 'ready'}">${escapeHtml(event.type || 'Normal')}</span>
            </div>
            <div class="event-meta">
              <span title="${escapeHtml(absolute)}">${escapeHtml(when)}</span>
              <span>å‘½åç©ºé—´ ${escapeHtml(event.namespace || '-')}</span>
              <span>${escapeHtml(event.kind || '-')}/${escapeHtml(event.name || '-')}${countLabel}</span>
            </div>
            <p>${escapeHtml(event.message || '')}</p>
          `;

          container.appendChild(item);
        });
      }

      function showEventsFeedback(message, success) {
        const box = document.getElementById('events-feedback');
        if (!box) {
          return;
        }
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      function openEventsModal(title, events) {
        if (!eventsModal || !eventsModalTitle || !eventsModalList) {
          return;
        }
        eventsModalTitle.textContent = title;
        renderEventsList(events, eventsModalList);
        eventsModal.classList.add('show');
        eventsModal.removeAttribute('hidden');
        document.body.classList.add('modal-open');
        eventsModalOpen = true;
      }

      function closeEventsModal() {
        if (!eventsModal) {
          return;
        }
        eventsModal.classList.remove('show');
        eventsModal.setAttribute('hidden', '');
        document.body.classList.remove('modal-open');
        eventsModalOpen = false;
      }

      async function fetchPods({ retainSelection = false } = {}) {
        try {
          const res = await fetch('/api/pods', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const data = await res.json();
          podsCache = Array.isArray(data) ? data : [];

          if (!retainSelection || !activePod || !podsCache.find(p => p.name === activePod)) {
            activePod = podsCache.length ? podsCache[0].name : null;
          }

          refreshPodsTable();

          if (activePod) {
            await fetchPodDetail(activePod, { silent: true });
          } else {
            renderPodDetail(null);
          }

          showPodsFeedback('Pod åˆ—è¡¨å·²åˆ·æ–°', true);
        } catch (err) {
          showPodsFeedback(`Pod åˆ—è¡¨è·å–å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderPodsTable(pods) {
        const tbody = document.querySelector('#pod-table tbody');
        tbody.innerHTML = '';

        if (!pods || pods.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="7">æš‚æ—  Pod è®°å½•</td>';
          tbody.appendChild(row);
          return;
        }

        pods.forEach(pod => {
          const row = document.createElement('tr');
          row.dataset.name = pod.name;
          row.className = pod.name === activePod ? 'active' : '';
          row.innerHTML = `
            <td>${escapeHtml(pod.name)}</td>
            <td>${escapeHtml(pod.namespace)}</td>
            <td>${escapeHtml(pod.status)}</td>
            <td>${escapeHtml(pod.readyContainers)}</td>
            <td>${pod.restarts}</td>
            <td>${escapeHtml(pod.node || 'æœªè°ƒåº¦')}</td>
            <td>${escapeHtml(pod.age || '-')}</td>
          `;
          row.addEventListener('click', () => {
            activePod = pod.name;
            highlightPodSelection();
            fetchPodDetail(pod.name);
          });
          tbody.appendChild(row);
        });
      }

      function highlightPodSelection() {
        document.querySelectorAll('#pod-table tbody tr').forEach(row => {
          row.classList.toggle('active', row.dataset.name === activePod);
        });
      }

      async function fetchPodDetail(name, { silent = false } = {}) {
        if (!name) {
          renderPodDetail(null);
          return;
        }

        try {
          const res = await fetch(`/api/pods/${encodeURIComponent(name)}`, { cache: 'no-store' });
          if (!res.ok) {
            if (res.status === 404) {
              throw new Error('Pod ä¸å­˜åœ¨');
            }
            throw new Error(`è¯·æ±‚å¤±è´¥: ${res.status}`);
          }
          const detail = await res.json();
          renderPodDetail(detail);
          if (!silent) {
            showPodsFeedback(`Pod ${name} è¯¦æƒ…å·²æ›´æ–°`, true);
          }
        } catch (err) {
          showPodsFeedback(`è·å– Pod ${name} è¯¦æƒ…å¤±è´¥ï¼š${err.message}`, false);
        }
      }

      function renderPodDetail(detail) {
        const container = document.getElementById('pod-detail-content');
        if (!detail) {
          container.innerHTML = '<p class="subtitle">æš‚æœªé€‰æ‹© Pod</p>';
          return;
        }

        const status = (detail.status || '').toLowerCase();
        let statusClass = 'unknown';
        if (status === 'running' || status === 'succeeded') {
          statusClass = 'ready';
        } else if (status === 'failed' || status === 'crashloopbackoff') {
          statusClass = 'notready';
        }

        const images = (detail.images || []).map(img => escapeHtml(img)).join('<br />') || '-';
        const containers = detail.containers && detail.containers.length
          ? detail.containers
              .map(c => `
                <li>
                  <strong>${escapeHtml(c.name)}</strong>
                  <small>é•œåƒï¼š${escapeHtml(c.image)}</small>
                  <small>${c.ready ? 'çŠ¶æ€ï¼šå·²å°±ç»ª' : 'çŠ¶æ€ï¼šæœªå°±ç»ª'} Â· é‡å¯ ${c.restartCount}</small>
                </li>
              `)
              .join('')
          : '<li>æš‚æ— å®¹å™¨ä¿¡æ¯</li>';

        const logsText = detail.logs && detail.logs.length
          ? escapeHtml(detail.logs.join('\n'))
          : 'æš‚æ— æ—¥å¿—è¾“å‡º';

        container.innerHTML = `
          <div class="detail-header">
            <h3>${escapeHtml(detail.name)}</h3>
            <span class="badge ${statusClass}">${escapeHtml(detail.status)}</span>
          </div>
          <div class="detail-meta">
            <div class="item">
              <strong>å‘½åç©ºé—´</strong>
              <span>${escapeHtml(detail.namespace)}</span>
            </div>
            <div class="item">
              <strong>æ‰€åœ¨èŠ‚ç‚¹</strong>
              <span>${escapeHtml(detail.node || 'æœªè°ƒåº¦')}</span>
            </div>
            <div class="item">
              <strong>å®¹å™¨å°±ç»ª</strong>
              <span>${escapeHtml(detail.readyContainers)}</span>
            </div>
            <div class="item">
              <strong>é‡å¯æ¬¡æ•°</strong>
              <span>${detail.restarts}</span>
            </div>
            <div class="item">
              <strong>é•œåƒ</strong>
              <span>${images}</span>
            </div>
            <div class="item">
              <strong>å­˜åœ¨æ—¶é—´</strong>
              <span>${escapeHtml(detail.age || '-')}</span>
            </div>
          </div>
          <div class="detail-section">
            <h3>å®¹å™¨</h3>
            <ul>${containers}</ul>
          </div>
          <div class="detail-section">
            <h3>æœ€æ–°æ—¥å¿—</h3>
            <div class="log-panel"><pre>${logsText}</pre></div>
          </div>
          <div class="detail-section">
            <h3>äº‹ä»¶</h3>
            <button type="button" class="view-events-button" id="pod-events-button">æŸ¥çœ‹äº‹ä»¶</button>
          </div>
        `;

        const eventsButton = container.querySelector('#pod-events-button');
        if (eventsButton) {
          const hasEvents = Array.isArray(detail.events) && detail.events.length > 0;
          eventsButton.disabled = !hasEvents;
          eventsButton.addEventListener('click', () => {
            const events = Array.isArray(detail.events) ? detail.events : [];
            const mapped = events.map(ev => ({
              type: ev.type,
              reason: ev.reason,
              message: ev.message,
              namespace: detail.namespace,
              name: detail.name,
              timestamp: ev.timestamp,
              kind: 'Pod',
              count: ev.count || undefined
            }));
            openEventsModal(`Pod äº‹ä»¶ Â· ${detail.name}`, mapped);
          });
        }
      }

      function showPodsFeedback(message, success) {
        const box = document.getElementById('pods-feedback');
        box.textContent = message;
        box.classList.remove('success', 'error');
        box.classList.add(success ? 'success' : 'error');
        box.style.display = 'block';
      }

      function handleManualRefresh({ silent = false } = {}) {
        if (activeView === 'overview') {
          fetchOverview();
          fetchClusterImports({ silent });
        } else if (activeView === 'namespaces') {
          fetchNamespaces();
        } else if (activeView === 'nodes') {
          fetchNodes({ retainSelection: true });
        } else if (activeView === 'deployments') {
          fetchDeployments({ retainSelection: true });
        } else if (activeView === 'services') {
          fetchServices({ retainSelection: true });
        } else if (activeView === 'pods') {
          fetchPods({ retainSelection: true });
        } else if (activeView === 'logs') {
          fetchLogs({ silent });
          if (eventsModalOpen) {
            loadEvents({ silent: true }).catch(() => {});
          }
        }
      }

      document.getElementById('manual-refresh').addEventListener('click', () => handleManualRefresh());

      // åˆå§‹åŠ è½½
      fetchOverview();
      fetchClusterImports({ silent: true });
      fetchNamespaces();
      fetchNodes();
      fetchDeployments();
      fetchServices();
      fetchPods();
      fetchLogMeta();
      fetchLogs({ silent: true });

      setInterval(() => {
        handleManualRefresh({ silent: true });
      }, 15000);
    </script>
  </body>
</html>
